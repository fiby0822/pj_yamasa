#!/bin/bash
# ゼロ補完済みデータを使用したパイプライン実行スクリプト

echo "======================================================================"
echo "ヤマサ予測パイプライン（ゼロ補完済みデータ版）"
echo "開始時刻: $(date)"
echo "======================================================================"

# Python仮想環境のアクティベート
source venv/bin/activate

# ステップ1: ゼロ補完処理（既に実行済みの場合はスキップ可能）
echo ""
echo "【ステップ1】ゼロ補完処理"
echo "----------------------------------------------------------------------"
if [ "$1" = "--skip-zero-fill" ]; then
    echo "スキップ（--skip-zero-fillオプション指定）"
else
    python3 prepare_yamasa_data_step2.py
    if [ $? -ne 0 ]; then
        echo "エラー: ゼロ補完処理に失敗しました"
        exit 1
    fi
fi

# ステップ2: 特徴量生成（パターン1: 12特徴量版）
echo ""
echo "【ステップ2】特徴量生成"
echo "----------------------------------------------------------------------"
python3 create_features_pattern1.py
if [ $? -ne 0 ]; then
    echo "エラー: 特徴量生成に失敗しました"
    exit 1
fi

# ステップ3: モデル学習と予測
echo ""
echo "【ステップ3】モデル学習と予測"
echo "----------------------------------------------------------------------"
python3 train_predict_pattern1.py
if [ $? -ne 0 ]; then
    echo "エラー: モデル学習・予測に失敗しました"
    exit 1
fi

echo ""
echo "======================================================================"
echo "パイプライン完了"
echo "終了時刻: $(date)"
echo "======================================================================"